/*!taggstar-core 3.14.2 | 2022-12-07T10:43:59 | b4b588f6dc10afab738c48058e2ecd99a8df9565 | Copyright. All rights reserved. 2022. Digital Media Technologies Ltd.

Promise Polyfill | Copyright (c) 2014 Taylor Hakes - Forbes Lindesay | https://github.com/taylorhakes/promise-polyfill/blob/master/LICENSE*/
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}!function(e){var t=setTimeout;function r(){}function s(e){if("object"!==_typeof(this))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(e,this)}function n(a,r){for(;3===a._state;)a=a._value;0!==a._state?(a._handled=!0,s._immediateFn(function(){var e=1===a._state?r.onFulfilled:r.onRejected;if(null!==e){var t;try{t=e(a._value)}catch(e){return void i(r.promise,e)}o(r.promise,t)}else(1===a._state?o:i)(r.promise,a._value)})):a._deferreds.push(r)}function o(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"===(void 0===e?"undefined":_typeof(e))||"function"==typeof e)){var a=e.then;if(e instanceof s)return t._state=3,t._value=e,void g(t);if("function"==typeof a)return void l(function(e,t){return function(){e.apply(t,arguments)}}(a,e),t)}t._state=1,t._value=e,g(t)}catch(e){i(t,e)}}function i(e,t){e._state=2,e._value=t,g(e)}function g(e){2===e._state&&0===e._deferreds.length&&s._immediateFn(function(){e._handled||s._unhandledRejectionFn(e._value)});for(var t=0,a=e._deferreds.length;t<a;t++)n(e,e._deferreds[t]);e._deferreds=null}function c(e,t,a){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=a}function l(e,t){var a=!1;try{e(function(e){a||(a=!0,o(t,e))},function(e){a||(a=!0,i(t,e))})}catch(e){if(a)return;a=!0,i(t,e)}}s.prototype.catch=function(e){return this.then(null,e)},s.prototype.then=function(e,t){var a=new this.constructor(r);return n(this,new c(e,t,a)),a},s.all=function(e){var i=Array.prototype.slice.call(e);return new s(function(r,n){if(0===i.length)return r([]);var s=i.length;function o(t,e){try{if(e&&("object"===(void 0===e?"undefined":_typeof(e))||"function"==typeof e)){var a=e.then;if("function"==typeof a)return void a.call(e,function(e){o(t,e)},n)}i[t]=e,0==--s&&r(i)}catch(e){n(e)}}for(var e=0;e<i.length;e++)o(e,i[e])})},s.resolve=function(t){return t&&"object"===(void 0===t?"undefined":_typeof(t))&&t.constructor===s?t:new s(function(e){e(t)})},s.reject=function(a){return new s(function(e,t){t(a)})},s.race=function(n){return new s(function(e,t){for(var a=0,r=n.length;a<r;a++)n[a].then(e,t)})},s._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){t(e,0)},s._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},s._setImmediateFn=function(e){s._immediateFn=e},s._setUnhandledRejectionFn=function(e){s._unhandledRejectionFn=e},"undefined"!=typeof module&&module.exports?module.exports=s:e.Promise||(e.Promise=s)}(window),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var a=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(a[s]=n[s])}return a},writable:!0,configurable:!0}),window.taggstar||(window.taggstar={lib:{}}),function(i){function d(e){var t,a=taggstar.config,r=taggstar.util,n=["_taggstar_ses","_taggstar_vid"],s=e.message||"TAGGSTAR: Error!!",o=function(){try{var e,t=i.navigator&&i.navigator.userAgent,a=t.match(/(opera|chrome|safari|firefox|msie|trident|edge(?=\/))\/?\s*(\d+)(\.\d+)+/i)||[];if(/trident/i.test(a[1]))return{name:"IE",version:(e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""};if("Chrome"===a[1]){if(null!=(e=t.match(/\bOPR\/(\d+)/)))return{name:"Opera",version:e[1]};if(null!=(e=t.match(/\bEdge\/(\d+(.\d+)+)/i)))return{name:"Microsoft Edge",version:e[1]}}return a=a[2]?[a[1],a[0].substring(a[0].indexOf("/")+1)]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&a.splice(1,1,e[1]),{name:a[0],version:a[1]}}catch(e){return{name:"unknown",version:"1"}}}()||{};a&&!a.experienceRequired&&n.push("_taggstar_exp"),a&&a.assistant&&!a.assistant.experienceRequired&&n.push("_taggstar_exps"),this.name=e.name||"TaggstarError",this.siteKey=e.siteKey||a&&a.key||taggstar.tm&&taggstar.tm.key,this.code=e.code||"ERR01",this.message=s,this.host=r&&r.getRootDomain()||i.location&&i.location.host,this.href=i.location&&i.location.href,this.timestamp=Date.now(),this.severity=e.severity||50,this.environment=a&&a.environment||taggstar.params&&taggstar.params.taggEnv||"prod",this.browser=o.name,this.browserVersion=o.version,this.locale=i.navigator&&i.navigator.language,this.cookies=function(e){var t=taggstar.util;return t&&"function"==typeof t.getCookie?e.map(function(e){return{name:e,value:t.getCookie(e)}}):null}(n),this.module=e.module||(a?a.module:null),this.minSeverity=a?a.errorMinSeverity:0,this.sendingProbability=a?a.errorSendingProbability:1,e.stack?this.stack=e.stack:((t=new Error(s)).name=this.name,t.stack?this.stack=t.stack:this.stack=s)}(d.prototype=Object.create(Error.prototype)).constructor=d,taggstar.exception={Error:d,handle:function t(e,a){var r,n,s,o,i,g,c=!1,l=taggstar.util,u=taggstar.log;a=a||0;try{if(!(e instanceof d)&&a<2)throw a+=1,new d({name:e.name,message:e.message,stack:e.stack||e.message});if(!l&&!u)return void console.error("TAGGSTAR:",e);if(taggstar.log(e,"error"),"qa"===e.environment)return;try{l.jsonCall&&e instanceof d&&(s=taggstar.config,i=e.sendingProbability,g=e.minSeverity,n=s&&s.api&&s.api.log,e.severity<g?c=!0:i<=0?c=!0:i<1&&(c=i<(o=Math.random())),taggstar.log(l.renderTemplate("silent mode calculation values are min severity: {errorMinSeverity} - probability: {errorSendingProbability} - random: {random} - silentMode:  {silentMode}}",{errorMinSeverity:g,errorSendingProbability:i,random:o||"NaN",silentMode:c}),"info"),!c&&n&&(r=s.urls.logRoot+n.endpoint)&&l.jsonCall(n.verb,r,JSON.stringify(e)).then(function(e){taggstar.log("log sent successfully","info")}).catch(function(e){taggstar.log(e,"error")}))}catch(e){taggstar.log(e,"error")}}catch(e){t(e,a)}}}}(window),taggstar.initConfig=function(t,r,e,a){r=r||"prod",a=a&&(a+"").trim().toLowerCase();function n(e,t){var a=l[r][t];return c.renderTemplate(e,{alias:a.alias,topLevel:a.topLevel,protocol:a.protocol})}function s(e){return c.renderTemplate(e,{key:t})}var o,i,g=taggstar.exception.Error,c=taggstar.util,l={prod:{api:{topLevel:"com",alias:a?"api."+a:"api",protocol:""},log:{topLevel:"com",alias:a?"log."+a:"log",protocol:""}},qa:{api:{topLevel:"com",alias:"api.qa",protocol:""},log:{topLevel:"com",alias:"log",protocol:""}},dev:{api:{topLevel:"net:8080",alias:"api.dev",protocol:"http:"},log:{topLevel:"net:8080",alias:"log.dev",protocol:"http:"}}};if(!t)throw new g({message:"sitekey should be defined",code:"CONFIG01",severity:99});if(!l[r])throw new g({message:"invalid environment value: "+r,code:"CONFIG02",severity:99,siteKey:t});return o=n("{protocol}//{alias}.taggstar.{topLevel}","api"),i=n("{protocol}//{alias}.taggstar.{topLevel}","log"),{version:"",cookieVersion:"3",idGenerator:taggstar.lib.uuid.generate,key:t,region:a,environment:r,urls:{configRoot:o,apiRoot:o,logRoot:i},currencyCode:"GBP",defaultLocale:"en-GB",locale:"",experienceRequired:!1,experimentId:null,experienceId:"default",sitePrefix:"/",deviceType:"",interval:500,tries:50,jquery:"",carouselJS:"",carouselCSS:"",module:"",modules:{},errorMinSeverity:0,errorSendingProbability:1,detail:!1,assistant:{experienceRequired:!1,experienceId:"",pageType:""},api:{category:{endpoint:s("/api/v2/key/{key}/category/visit"),verb:"POST",mandatoryFields:{},optionalFields:{}},product:{endpoint:s("/api/v2/key/{key}/product/visit"),verb:"POST",mandatoryFields:{},optionalFields:{}},productUpdate:{endpoint:s("/api/v2/key/{key}/product/update"),verb:"POST",mandatoryFields:{},optionalFields:{}},conversion:{endpoint:s("/api/v2/key/{key}/conversion/order"),verb:"POST",mandatoryFields:{},optionalFields:{}},basket:{endpoint:s("/api/v2/key/{key}/basket/visit"),verb:"POST",mandatoryFields:{},optionalFields:{}},event:{endpoint:s("/api/v2/key/{key}/event"),verb:"POST"},eventQuery:{endpoint:s("/api/v2/key/{key}/event/query"),verb:"POST"},configuration:{endpoint:s("/api/v2/key/{key}/config{query}"),verb:"GET",mock:e},log:{endpoint:"/api/v1/logs",verb:"POST"},assistant:{endpoint:s("/api/v2/key/{key}/assistant/query"),verb:"POST",mandatoryFields:{},optionalFields:{}},products:{endpoint:s("/api/v2/key/{key}/products"),verb:"GET"}}}},function(){var d=taggstar.exception.Error;taggstar.util={windowWrapper:{getLocation:function(){return window.location},isCookie:function(){return window.navigator.cookieEnabled},setCookie:function(e){document.cookie=e},getCookie:function(){return document.cookie},createElement:function(e){return document.createElement(e)},appendChild:function(e,t){e.appendChild(t)},getElementsByTagName:function(e){return document.getElementsByTagName(e)},getElementById:function(e){return document.getElementById(e)},getXMLHttpRequest:function(){return new XMLHttpRequest},isLocalStorage:function(){var e="_taggstar_test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch(e){return!1}},getLocalStorage:function(e){return window.localStorage.getItem(e)},setLocalStorage:function(e,t){window.localStorage.setItem(e,t)},removeLocalStorage:function(e){return window.localStorage.removeItem(e)}},loadTag:function(i,g,c,l,u){return new Promise(function(e,a){g=g||"script",c=c||"head";var t,r,n=taggstar.util,s=n.windowWrapper,o="src";if(i){switch(t=s.createElement(g),g){case"script":t.async=!0;break;case"link":t.type="text/css",t.rel="stylesheet",o="href"}if(r=s.getElementsByTagName(c),t[o]=i,l&&(t.id=l),u&&(t.integrity=u,t.crossOrigin="anonymous"),t.onload=function(){e({tag:g,url:i,id:l,sri_hash:u})},t.onerror=function(e){var t="string"==typeof e?n.renderTemplate("{error} while requesting url: {url}",{error:e,url:i}):e&&e.message?e.message:n.renderTemplate("error while requesting url: {url}",{url:i});a(new d({message:t,code:"UTIL11",severity:99}))},0<r.length)if(l){if(null!==s.getElementById(l))return void a(new d({message:n.renderTemplate("trying to add an existing tag: <{url}>",{url:i}),code:"UTIL14",severity:99}));s.appendChild(r[0],t)}else s.appendChild(r[0],t);else a(new d({message:n.renderTemplate("no <{parent}> tag found to append url: {url}",{parent:c,url:i}),code:"UTIL12",severity:99}))}else a(new d({message:n.renderTemplate("url not provided for <{tag}> tag injection inside <{parent}> element",{tag:g,parent:c}),code:"UTIL01",severity:99}))})},jsonCall:function(e,o,t){return new Promise(function(a,r){var n=taggstar.util,s=n.windowWrapper.getXMLHttpRequest();if(s){t=t||null,s.open(e,o,!0);try{"responseType"in s&&(s.responseType="json")}catch(e){}s.onload=function(){var e=s.status,t="json"===s.responseType?s.response:JSON.parse(s.responseText);200<=e&&e<300?a(t):r(new d({message:n.renderTemplate("{errorDetail} for url: {url}",{status:e,url:o,errorDetail:t&&t.result&&t.result.errorMessage?t.result.errorMessage:"error"}),code:"UTIL09",severity:81}))},s.onerror=function(){r(new d({message:n.renderTemplate("connection failure for url: {url}",{url:o}),code:"UTIL10",severity:81}))},s.send(t)}else r(new d({message:"failed to create XMLHttpRequest object",code:"UTIL13",severity:81}))})},renderTemplate:function(e,t){var a,r;for(a in t)r=t[a],e=e.replace(new RegExp("{"+a+"}","g"),r);return e},isCookie:function(){return taggstar.util.windowWrapper.isCookie()},setCookie:function(e,t,a){var r,n,s=taggstar&&taggstar.config&&taggstar.config.sitePrefix;if(!e)throw new d({message:"name not defined",code:"UTIL03",severity:81});if(!s)throw new d({message:"sitePrefix not defined",code:"UTIL04",severity:81});n=a?((r=new Date).setTime(r.getTime()+60*a*1e3),"; expires="+r.toUTCString()):"",taggstar.util.windowWrapper.setCookie(e+"="+t+n+"; path="+s+";domain="+taggstar.util.getRootDomain())},getCookie:function(e){var t,a,r=e+"=",n=(taggstar.util.windowWrapper.getCookie()||"").split(";");for(t=0;t<n.length;t++){for(a=n[t];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(r))return a.substring(r.length,a.length)}return null},deleteCookie:function(e){taggstar.util.setCookie(e,"",-1)},saveLocalStorage:function(e,t,a){if(!taggstar.util.windowWrapper.isLocalStorage())return!1;var r=60*(a||30)*1e3,n={value:JSON.stringify(t),timestamp:(new Date).getTime()+r},s="_"+taggstar.config.key;return taggstar.util.windowWrapper.setLocalStorage(e+s,JSON.stringify(n)),t},loadLocalStorage:function(e){if(!taggstar.util.windowWrapper.isLocalStorage())return!1;var t,a="_"+taggstar.config.key;return!!(t=JSON.parse(taggstar.util.windowWrapper.getLocalStorage(e+a)))&&((new Date).getTime()<t.timestamp&&JSON.parse(t.value))},removeLocalStorage:function(e){if(!taggstar.util.windowWrapper.isLocalStorage())return!1;var t="_"+taggstar.config.key;return taggstar.util.windowWrapper.removeLocalStorage(e+t),!0},setPageData:function(e,t,a){a=a||taggstar.config.module||"general",taggstar.pageData=taggstar.pageData||{},taggstar.pageData[a]=taggstar.pageData[a]||{},taggstar.pageData[a][e]=t},getPageData:function(e,t){return t=t||taggstar.config.module||"general",taggstar.pageData=taggstar.pageData||{},taggstar.pageData[t]=taggstar.pageData[t]||{},taggstar.pageData[t][e]},deletePageData:function(e,t){t=t||taggstar.config.module||"general",taggstar.pageData&&taggstar.pageData[t]&&taggstar.pageData[t][e]&&delete taggstar.pageData[t][e]},encodeCookieString:function(e){var t,a,r="v:"+e.cookieVersion,n={id:"experimentId",group:"experimentGroup",visitor:"id"};for(a in"3"===e.cookieVersion&&delete n.visitor,n)t=void 0===e[n[a]]?"":e[n[a]],r+=(void 0||"|")+a+(void 0||":")+t;return r},decodeCookieString:function(e,t){if(!e)return null;var a,r,n,s,o,i,g={cookieVersion:e.substring(2,3)};if(i=parseInt(g.cookieVersion,10),isNaN(i)||3<i)return taggstar.util.deleteCookie("_taggstar_exp"),null;try{for(a=e.split("|"),r=1;r<a.length;r++)switch(s=(n=a[r].split(":"))[0],o="null"==n[1]||"undefined"==n[1]?"":n[1],g.cookieVersion){case"1":switch(s){case"visitor":g.id=o;break;case"basket":case"category":case"product":g.experimentGroup=o;break;default:g.experimentId=o}break;case"2":switch(s){case"visitor":g.id=o;break;case"group":g.experimentGroup=o;break;case"id":g.experimentId=o}break;case"3":switch(s){case"group":g.experimentGroup=o;break;case"id":g.experimentId=o}}t||(g.modules={product:g.experimentGroup,category:g.experimentGroup,basket:g.experimentGroup})}catch(e){taggstar.exception.handle(e),taggstar.util.deleteCookie("_taggstar_exp"),g=null}return g},decodeCookieStringV2:function(e){if(!e)return null;var t=null;try{t=JSON.parse(e)}catch(e){taggstar.exception.handle(e),taggstar.util.deleteCookie("_taggstar_exps"),t=null}return t},getRootDomain:function(){var e,t=taggstar.util.windowWrapper.getLocation().host.toLowerCase(),a=t;return null!=t&&1<(e=t.split(".").reverse()).length&&(a=2<e.length&&("co"===e[1]||"com"===e[1])?e[2]+"."+e[1]+"."+e[0]:e[1]+"."+e[0]),a},cleanDuplicateProducts:function(e){var t,a,r,n,s,o,i,g,c,l={},u=[];if(!e)return[];for(t=0;t<e.length;t++){if(s=(a=e[t]).id,o=parseFloat(a.unitPrice),i=parseFloat(a.quantity),g=a.category,isNaN(o)||isNaN(i))throw new d({message:"invalid product unit price/quantity value",code:"UTIL07",severity:71});if(!s)throw new d({message:"invalid product id",code:"UTIL08",severity:71});if(a.variant)for(c in a.variant)a.variant.hasOwnProperty(c)&&(s+="_"+a.variant[c]);l[s]?l[s].quantity+=i:(l[s]={quantity:i,unitPrice:o,id:a.id},a.category&&(l[s].category=g),a.variant&&(l[s].variant=a.variant),a.stock&&(l[s].stock=a.stock))}for(r in l)l.hasOwnProperty(r)&&(n={id:(a=l[r]).id,quantity:a.quantity,unitPrice:a.unitPrice},a.category&&(n.category=a.category),a.variant&&(n.variant=a.variant),a.stock&&(n.stock=a.stock),u.push(n));return u},getBalloonClass:function(e,t,a){var r,n="balloon";if(!e||!e.code||!e.category)throw new d({message:"invalid message parameter",code:"UTIL06",severity:91});return r="QPH"===e.code,"boolean"==typeof t?r=t:"string"==typeof t&&(n=t),"tagg-reset tagg-"+n+" tagg-"+e.category.toLowerCase()+" tagg-"+e.code+(r?" tagg-hot":"")+(a?" "+a:"")},getBalloon:function(e,t,a,r){if(e){a=taggstar.$.extend({decor:!0,closeButton:!1},a);var n,s='<div class="'+taggstar.util.getBalloonClass(e,t,a.extraBalloonClass)+'"><div class="tagg-reset tagg-icon"></div><div class="tagg-reset tagg-txt">'+(e.text?e.text:e.message)+"</div>";return s+=a.decor?'<div class="tagg-reset tagg-decor"></div>':"",s+=a.closeButton?'<div class="tagg-reset tagg-x"></div></div>':"",n=taggstar.$(s),a.iconCss&&n.find(".tagg-icon").css(a.iconCss),a.txtCss&&n.find(".tagg-txt").css(a.txtCss),a.closeCss&&n.find(".tagg-x").css(a.closeCss),void 0!==r&&n.data("tagg-index",r),n}},getBalloonParams:function(e,t){var a=taggstar.$.extend(taggstar._defaultMessageParams,e);return a.wrapperClass+=a.isMobile?"-n":"",a.experienceWrapperClass=taggstar.config.experienceRequired?"tagg-"+taggstar.config.experienceId.replace(/[^_a-zA-Z0-9-]/g,"_"):"",a.callback||"function"!=typeof t||(a.callback=t),a},getParams:function(e,t,a){var r=taggstar.$.extend(taggstar._defaultParams[e],t);return r.wrapperClass+=r.isMobile?"-n":"",r.experienceWrapperClass=taggstar.config[e].experienceRequired?"tagg-"+taggstar.config[e].experienceId.replace(/[^_a-zA-Z0-9-]/g,"_"):"",r.callback||"function"!=typeof a||(r.callback=a),r},getBalloonContainer:function(e){var t="tagg-reset "+e.wrapperClass+(e.extraClass?" "+e.extraClass:"")+(e.experienceWrapperClass?" "+e.experienceWrapperClass:"");return e.wrapperStyle?taggstar.$('<div class="'+t+'"></div>').css(e.wrapperStyle):taggstar.$('<div class="'+t+'"></div>')},getQueryParams:function(){var e,t,a,r=taggstar.util.windowWrapper.getLocation().search.substring(1),n={};if(!r)return n;for(e=r.split("&"),t=0;t<e.length;t++)0===(a=e[t].split("="))[0].indexOf("tagg")&&(n[a[0]]=!(1<a.length)||a[1]);return n},createTaggstarQueryString:function(){var e,t="?";for(e in taggstar.params)taggstar.params.hasOwnProperty(e)&&(t+=e+"="+taggstar.params[e]+"&");return taggstar.config.detail&&(t+="detail=true&"),t.slice(0,t.length-1)},validateDimensions:function(e){var t,a,r,n={};if(!e)return n;for(t=1;t<4;t++)(r=e[a="dim"+t])&&"string"==typeof r&&(n[a]=r.substring(0,32));return n},debugDialog:function(e,t,a){if(taggstar.debug){"object"===(void 0===t?"undefined":_typeof(t))&&(t=JSON.stringify(t));var r=taggstar.$('<div id="dialog"></div>');r.append("<h1>"+e+"</h1>"),r.append("<p>"+t+"</p>"),taggstar.$("body").append(r),r.css({position:"fixed",left:"35%",top:"20%",width:"50%",padding:"10px",height:"auto",background:a||"green",color:"white",fontSize:"11px",textAlign:"center",zIndex:1e4})}},getObjectByPath:function(e,t){for(var a=(t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),r=0,n=a.length;r<n;++r){var s=a[r];if(!(s in e))return null;e=e[s]}return e},assistant:{renderAssistantTemplate:function(e,t){var a,r,n,s;for(a in t)if("templates"===a)for(r in s=t[a])n=s[r],e=e.replace(new RegExp("{templates."+r+"}","g"),n);else n=t[a],e=e.replace(new RegExp("{"+a+"}","g"),n);return e},getAssistantCardAttributes:function(e,t,a,r){var n={},s=t&&t.product,o=s&&Array.isArray(s.images)&&0<s.images.length&&s.images[0].url;return s&&Object.keys(s).forEach(function(e){if(s.hasOwnProperty(e))switch(e){case"images":n.image="function"==typeof r.utils.image?r.utils.image(o):o;break;case"price":n.price="function"==typeof r.utils.price?r.utils.price(s.price,s.salePrice,s.fromPrice):s.price;break;default:n[e]="function"==typeof r.utils[e]?r.utils[e](s[e]):s[e]}}),n.algorithm=e,n.templates=a,n},getAssistant:function(t,a,r){if(a&&t){var n,e,s,o,i='<div class="'+("tagg-reset "+(r=taggstar.$.extend({},taggstar._defaultParams.assistant,r)).algoClass+" tagg-asst-"+t.toLowerCase()+(r.extraAlgoClass?" "+r.extraAlgoClass:""))+'"></div>';return e=taggstar.$(i),r.headerTemplate&&e.append(taggstar.util.assistant.renderAssistantTemplate(r.headerTemplate,{templates:a.templates})),r.subheaderTemplate&&e.append(taggstar.util.assistant.renderAssistantTemplate(r.subheaderTemplate,{templates:a.templates})),n=taggstar.$('<div class="tagg-reset tagg-asst-cards"></div>'),a.products.forEach(function(e){o=taggstar.$('<div class="tagg-reset tagg-asst-card"></div>'),r.cardImageTemplate&&o.append(taggstar.util.assistant.renderAssistantTemplate(r.cardImageTemplate,taggstar.util.assistant.getAssistantCardAttributes(t,e,a.templates,r))),r.cardInfoTemplate&&o.append(taggstar.util.assistant.renderAssistantTemplate(r.cardInfoTemplate,taggstar.util.assistant.getAssistantCardAttributes(t,e,a.templates,r))),r.cardAdditionalTemplate&&o.append(taggstar.util.assistant.renderAssistantTemplate(r.cardAdditionalTemplate,taggstar.util.assistant.getAssistantCardAttributes(t,e,a.templates,r))),0<e.messages.length&&(s=taggstar.util.assistant.getAssistantBalloon(e.messages,r),r.balloonAnchor?o.find(r.balloonAnchor)[r.balloonAnchorInsertFunction](s):o[r.balloonAnchorInsertFunction](s)),o.on("click","a",r.onCardClick),n.append(o)}),e.append(n),r.additionalTemplate&&e.append(taggstar.util.assistant.renderAssistantTemplate(r.additionalTemplate,{templates:a.templates})),r.footerTemplate&&e.append(taggstar.util.assistant.renderAssistantTemplate(r.footerTemplate,{templates:a.templates})),e}},getAssistantBalloon:function(e,t){var a,r,n,s="tagg-reset "+t.balloonWrapperClass+(t.balloonExtraClass?" "+t.balloonExtraClass:""),o=taggstar.$('<div class="'+s+'"></div>');return e.forEach(function(e){a="tagg-reset tagg-asst-balloon tagg-"+e.category.toLowerCase()+" tagg-"+e.code+("QPH"===e.code?" tagg-hot":"")+(t.balloonExtraBalloonClass?" "+t.balloonExtraBalloonClass:""),r='<div class="'+a+'"><div class="tagg-reset tagg-icon"></div><div class="tagg-reset tagg-txt">'+e.message+"</div>",r+=t.balloonDecor?'<div class="tagg-reset tagg-decor"></div>':"",r+=t.balloonCloseButton?'<div class="tagg-reset tagg-x"></div></div>':"",n=taggstar.$(r),o.append(n)}),o},getAssistantContainer:function(e){var t="tagg-reset "+e.wrapperClass+(e.extraClass?" "+e.extraClass:"")+(e.experienceWrapperClass?" "+e.experienceWrapperClass:"");return taggstar.$('<div class="'+t+'"></div>')}}}}(),function(){var e;if(!e){var a=new Array(16);e=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),a[t]=e>>>((3&t)<<3)&255;return a}}for(var t=Array,n=[],s={},r=0;r<256;r++)n[r]=(r+256).toString(16).substr(1),s[n[r]]=r;function p(e,t){var a=t||0,r=n;return r[e[a++]]+r[e[a++]]+r[e[a++]]+r[e[a++]]+"-"+r[e[a++]]+r[e[a++]]+"-"+r[e[a++]]+r[e[a++]]+"-"+r[e[a++]]+r[e[a++]]+"-"+r[e[a++]]+r[e[a++]]+r[e[a++]]+r[e[a++]]+r[e[a++]]+r[e[a++]]}var o=e(),f=[1|o[0],o[1],o[2],o[3],o[4],o[5]],m=16383&(o[6]<<8|o[7]),v=0,y=0;var i={v1:function(e,t,a){var r=t&&a||0,n=t||[],s=null!=(e=e||{}).clockseq?e.clockseq:m,o=null!=e.msecs?e.msecs:(new Date).getTime(),i=null!=e.nsecs?e.nsecs:y+1,g=o-v+(i-y)/1e4;if(g<0&&null==e.clockseq&&(s=s+1&16383),(g<0||v<o)&&null==e.nsecs&&(i=0),1e4<=i)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");v=o,m=s;var c=(1e4*(268435455&(o+=122192928e5))+(y=i))%4294967296;n[r++]=c>>>24&255,n[r++]=c>>>16&255,n[r++]=c>>>8&255,n[r++]=255&c;var l=o/4294967296*1e4&268435455;n[r++]=l>>>8&255,n[r++]=255&l,n[r++]=l>>>24&15|16,n[r++]=l>>>16&255,n[r++]=s>>>8|128,n[r++]=255&s;for(var u=e.node||f,d=0;d<6;d++)n[r+d]=u[d];return t||p(n)},parse:function(e,t,a){var r=t&&a||0,n=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){n<16&&(t[r+n++]=s[e])});n<16;)t[r+n++]=0;return t}};i.unparse=p,i.BufferClass=t,taggstar.lib.uuid={generate:function(){var e=+new Date,t=e-taggstar.initTimestamp;return i.v1({msecs:e,nsecs:t%1e4})}}}(),function(){var x=taggstar.exception.Error,k=taggstar.util,r="_taggstar_ses",n="_taggstar_exp",a="_taggstar_exps",s="_taggstar_vid",d="_taggstar_cfg",T="tagg_module",_="tagg_style",D="tagg_jquery",p="tagg_carousel_js",f="tagg_carousel_css",y="|TAGGSTAR|",c="_taggstar_click";taggstar.loaded=!1,taggstar.version="3.14.2",taggstar.constant={null:"_taggstar_null"},taggstar.console=[],taggstar.assistant={},taggstar.log=function(e,t){(taggstar.debug||!taggstar.configured&&(taggstar.params&&taggstar.params.taggDebug||k&&k.getQueryParams().taggDebug))&&(t=t||"log",console[t]("TAGGSTAR: ",e),taggstar.console.push({level:t,message:e}))},taggstar.setup=function(){return new Promise(function(y,h){if(taggstar.configured)h(new x({message:"taggstar already configured",code:"CORE40",severity:99}));else{var e,t,a,r,w=taggstar.sri&&taggstar.sri.js,b=taggstar.sri&&taggstar.sri.css,C=taggstar.sri&&taggstar.sri.jquery,n=taggstar.tm&&taggstar.tm.key,s=taggstar.tm&&taggstar.tm.configUrl,o=taggstar.tm&&taggstar.tm.rgn,i=function(e){function t(e){var t=parseInt(e,10);return!isNaN(t)&&t}var a,r,n,s,o,i,g,c,l,u,d,p,f=taggstar.config,m=taggstar.tm&&taggstar.tm.style,v=[];e?(n=e.config&&e.config.config,s=e.config&&e.config.libs,i=e.config&&e.config.fileSet,"true"!==e.experienceRequired&&!0!==e.experienceRequired||(f.experienceRequired=!0),!e.assistant||"true"!==e.assistant.experienceRequired&&!0!==e.assistant.experienceRequired||(f.assistant.experienceRequired=!0),i?(a=i.default&&i.default.css,r=i.default&&i.default.js,(o=taggstar.devFileSet)&&(a=i[o]&&i[o].css,r=i[o]&&i[o].js),a&&r?(f.version=e.version||f.version,n&&(!1!==(g=t(n.maxDataLayerTries))&&-1<g&&(f.tries=g),!1!==(c=t(n.dataLayerRetryIntervalMs))&&-1<c&&(f.interval=c),!1!==(l=t(n.errorMinSeverity))&&(f.errorMinSeverity=l),d=n.errorSendingProbability,p=parseFloat(d),!1!==(u=!isNaN(p)&&p)&&0<=u&&(f.errorSendingProbability=u)),f.currencyCode=n&&n.defaultCurrencyCode||f.currencyCode,f.defaultLocale=e.defaultLocale||f.defaultLocale,f.jquery=s&&s.jquery||f.jquery,f.carouselJS=s&&s.carouselJS||f.carouselJS,f.carouselCSS=s&&s.carouselCSS||f.carouselCSS,f.sitePrefix=e.config&&e.config.sitePrefix||f.sitePrefix,f.urls.apiRoot=e.apiHostname||f.urls.apiRoot,m&&v.push(k.loadTag(a,"link","head",_,b)),f.jquery&&v.push(k.loadTag(f.jquery,"script","head",D,C)),v.length?Promise.all(v).then(function(e){e.forEach(function(e){taggstar.log(e.url+" "+e.tag+" tag loaded","info"),"script"===e.tag&&e.id===D&&(taggstar.$=jQuery.noConflict(!0))}),k.loadTag(r,"script","body",T,w).then(function(e){taggstar.log(e.url+" script tag loaded","info"),delete taggstar.tm,y(!0)}).catch(h)}).catch(h):k.loadTag(r,"script","body",T,w).then(function(e){taggstar.log(e.url+" script tag loaded","info"),delete taggstar.tm,y(!0)}).catch(h)):h(new x({message:"config json data (fileSet) is null/invalid",code:"CORE01",severity:99}))):h(new x({message:"config json data (fileSet) is null/invalid",code:"CORE01",severity:99}))):h(new x({message:"config json data is null/invalid",code:"CORE01",severity:99}))};if(!k.isCookie())return taggstar.log("cookie not supported","info"),void y(!1);taggstar.log("setup started","info"),taggstar.initTimestamp=Date.now(),taggstar.params=Object.assign({},taggstar.params,k.getQueryParams()),taggstar.config=taggstar.initConfig(n,taggstar.params.taggEnv,s,o),taggstar.log("config object created with default values","info"),taggstar.configured=!0,taggstar.fakeData=taggstar.params.taggFakeData,taggstar.keepUI=taggstar.params.taggKeepUI,taggstar.devFileSet=taggstar.params.taggDFS,delete taggstar.params.taggKeepUI,delete taggstar.params.taggEnv,delete taggstar.params.taggDFS,taggstar.debug="prod"!==taggstar.config.environment||0<Object.keys(taggstar.params).length,taggstar.responseData={},(e=!taggstar.debug&&k.loadLocalStorage(d))?i(e):(t=taggstar.config,a=t.api.configuration,r=t.urls.configRoot+k.renderTemplate(a.endpoint,{query:"?flattened=false"}),a.mock&&(r=a.mock),k.jsonCall(a.verb,r).then(function(e){return taggstar.log("request config from api server","info"),e&&!taggstar.debug&&(taggstar.log("create local storage for config","info"),k.saveLocalStorage(d,e,60)),e}).then(i).catch(h))}})},taggstar.boot=function(l,u){return new Promise(function(e,t){var a,r,n=0,s=!1,o=taggstar.config,i=o.tries,g=o.interval,c=o.jquery;"function"==typeof l?(taggstar.booting=!0,taggstar.log("booting..."),r=setInterval(function(){if(taggstar.booting){if(taggstar.$||c||(taggstar.$=window.jQuery),!taggstar.$)return i<=++n?(clearInterval(r),delete taggstar.booting,void t(new x({message:"jQuery couldn't be loaded. jQuery not found",code:"CORE02",severity:99,module:"socialproof"}))):void(n%5==0&&taggstar.log("jQuery not loaded","warn"));if(!a)try{o.module=a=l()}catch(e){return i<=++n?(clearInterval(r),delete taggstar.booting,void t(e instanceof x?e:new x({stack:e.stack,name:e.name,message:e.message,code:"CORE03",severity:99,module:"socialproof"}))):void 0}if(a&&a!==taggstar.constant.null){if(!u||!u[a]||"function"!=typeof u[a].condition)return clearInterval(r),delete taggstar.booting,void t(new x({message:"settings invalid (module name or related condition function exists? )",code:"CORE31",severity:99}));if(!s)try{s=u[a].condition()}catch(e){return i<=++n?(clearInterval(r),delete taggstar.booting,void t(e instanceof x?e:new x({stack:e.stack,name:e.name,message:e.message,code:"CORE28",severity:99}))):void 0}if(s){if(clearInterval(r),delete taggstar.booting,"function"!=typeof u[a].module)return void t(new x({message:"settings invalid (module function exists? )",code:"CORE32",severity:99}));taggstar.log("successful boot");try{u[a].module(),e(!0)}catch(e){return void t(e instanceof x?e:new x({stack:e.stack,name:e.name,message:e.message,code:"CORE33",severity:99}))}}else{if(i<=++n)return clearInterval(r),delete taggstar.booting,void t(new x({message:"condition failed (data layer missing?)",code:"CORE30",severity:99}));n%5==0&&taggstar.log("waiting for condition function","warn")}}else{if(i<=++n)return clearInterval(r),delete taggstar.booting,void(a===taggstar.constant.null?(taggstar.log("null module detected!","warn"),e(!0)):t(new x({message:"booting failed during module detection (data layer missing?)",code:"CORE29",severity:99,module:"socialproof"})));a===taggstar.constant.null&&(a=void 0),n%5==0&&taggstar.log("waiting for module detection function","warn")}}},g)):t(new x({message:"first parameter of taggstar.boot should be type of function",code:"CORE25",severity:99,module:"socialproof"}))})},taggstar.assistant.boot=function(l,u){return new Promise(function(e,t){var a,r,n=0,s=!1,o=taggstar.config,i=o.jquery,g=o.tries,c=o.interval;"function"==typeof l?(taggstar.log("assistant booting..."),k.setPageData("booting",!0,"assistant"),a=setInterval(function(){if(k.getPageData("booting","assistant")){if(taggstar.$||i||(taggstar.$=window.jQuery),!taggstar.$)return g<=++n?(clearInterval(a),k.deletePageData("booting","assistant"),void t(new x({message:"jQuery couldn't be loaded. jQuery not found",code:"ASST02",severity:99,module:"assistant"}))):void(n%5==0&&taggstar.log("jQuery not loaded","warn"));if(!r)try{o.assistant.pageType=r=l()}catch(e){return g<=++n?(clearInterval(a),k.deletePageData("booting","assistant"),void t(e instanceof x?e:new x({stack:e.stack,name:e.name,message:e.message,code:"ASST06",severity:99,module:"assistant"}))):void 0}if(r&&r!==taggstar.constant.null){if(!u||!u[r]||"function"!=typeof u[r].condition)return clearInterval(a),k.deletePageData("booting","assistant"),void t(new x({message:"settings invalid (module name or related condition function exists? )",code:"ASST07",severity:99,module:r}));if(!s)try{s=u[r].condition()}catch(e){return g<=++n?(clearInterval(a),k.deletePageData("booting","assistant"),void t(e instanceof x?e:new x({stack:e.stack,name:e.name,message:e.message,code:"ASST08",severity:99,module:r}))):void 0}if(s){if(clearInterval(a),k.deletePageData("booting","assistant"),"function"!=typeof u[r].module)return void t(new x({message:"settings invalid (module function exists? )",code:"ASST09",severity:99,module:r}));taggstar.log("succesful assistant booting...");try{u[r].module(),e(!0)}catch(e){return void t(e instanceof x?e:new x({stack:e.stack,name:e.name,message:e.message,code:"ASST10",severity:99,module:r}))}}else{if(g<=++n)return clearInterval(a),k.deletePageData("booting","assistant"),void t(new x({message:"condition failed (data layer missing?)",code:"ASST11",severity:99,module:r}));n%5==0&&taggstar.log("waiting for assistant condition function","warn")}}else{if(g<=++n)return clearInterval(a),k.deletePageData("booting","assistant"),void(r===taggstar.constant.null?(taggstar.log("null module detected for assistant!","warn"),e(!0)):t(new x({message:"booting failed during page type detection (data layer missing?)",code:"ASST12",severity:99,module:"assistant"})));r===taggstar.constant.null&&(r=void 0),n%5==0&&taggstar.log("waiting for assistant page type detection function","warn")}}},c)):t(new x({message:"first parameter of taggstar.assistant.boot should be a function",code:"ASST01",severity:99,module:"assistant"}))})};taggstar.init=function(e){if(!taggstar.configured)throw new x({message:"config object not created yet",code:"CORE34",severity:20});if(e.hasOwnProperty("environment")||e.hasOwnProperty("key"))throw new x({message:"key/environment values cannot be set",code:"CORE27",severity:20});if(e.hasOwnProperty("experienceRequired"))throw new x({message:"experienceRequired value cannot be set",code:"CORE35",severity:20});if(e.hasOwnProperty("experienceId")&&!e.experienceId.trim())throw new x({message:"experienceId value is not valid",code:"CORE36",severity:20});if(e.hasOwnProperty("assistant")){if(e.assistant.hasOwnProperty("pageType"))throw new x({message:"pageType value cannot be set",code:"ASST34",severity:20,module:"assistant:"+(taggstar.config.assistant&&taggstar.config.assistant.pageType)});if(e.assistant.hasOwnProperty("experienceId")&&!e.assistant.experienceId.trim())throw new x({message:"experienceId value is not valid",code:"ASST35",severity:20,module:"assistant:"+(taggstar.config.assistant&&taggstar.config.assistant.pageType)});if(e.assistant.hasOwnProperty("experienceRequired"))throw new x({message:"experienceRequired value cannot be set",code:"ASST36",severity:20,module:"assistant:"+(taggstar.config.assistant&&taggstar.config.assistant.pageType)});taggstar.$.extend(taggstar.config.assistant,e.assistant),delete e.assistant}taggstar.$.extend(taggstar.config,e)},taggstar.submitData=function(n,s){return new Promise(function(r,l){var e,u,t,a;taggstar.config?(e=taggstar.config.api[n])?(t=e.verb,u=taggstar.config.urls.apiRoot+e.endpoint,u+=k.createTaggstarQueryString(),taggstar.log("posting data","info"),taggstar.log(s,"info"),a={url:u,data:JSON.stringify(s),dataType:"json",type:t,contentType:!1,success:function(e,t,a){e.result&&e.result.success?r({responseData:e,jqXHR:a}):l(new x({message:e.result.errorMessage,code:"CORE08",severity:51}))},error:function(e,t,a){var r,n,s,o=e&&e.responseJSON,i=o&&o.result,g=a||"error",c=51;e&&"412"==e.status&&(k.removeLocalStorage(d),taggstar.versionMismatch||(r=taggstar.config.module,n=taggstar.config.key,s=taggstar.config.region,taggstar.versionMismatch=!0,taggstar.tm={key:n,style:"conversion"!==r,region:s},taggstar.$("#"+_).remove(),taggstar.$("#"+T).remove(),taggstar.$("#"+D).remove(),taggstar.$("#"+p).remove(),taggstar.$("#"+f).remove(),k.setPageData("configured",!1,"assistant"),taggstar.configured=!1,taggstar.setup().catch(taggstar.exception.handle)),c=-1),l(new x({message:k.renderTemplate("{errorMessage}: {detailMessage} for url: {url}",{errorMessage:g,url:u,detailMessage:i&&i.errorMessage?i.errorMessage:""}),code:"CORE09",severity:c}))}},taggstar.$.ajax(a)):l(new x({message:"unknown API method: "+n,code:"CORE07",severity:99})):l(new x({message:"config not found",code:"CORE13",severity:99}))})},taggstar.assistantRequest=function(r){return new Promise(function(t,a){var e;r&&r.category&&(r.category=taggstar._sanitizeCategory(r.category)),r&&r.productIds&&(!Array.isArray(r.productIds)||Array.isArray(r.productIds)&&0===r.productIds.length)?a(new x({message:"product ids for assistant cannot be empty",code:"ASST26",severity:51,module:"assistant:"+(taggstar.config.assistant&&taggstar.config.assistant.pageType)})):(e=taggstar._buildRequestV2(r,"assistant"),taggstar.submitData("assistant",e).then(function(e){taggstar._addResponseToCookieV2(e.responseData,e.jqXHR,"assistant"),t(e.responseData)}).catch(function(e){a(e)}))})},taggstar.productRequest=function(s,o){return new Promise(function(t,a){var e,r;if(e="update"===(o=o||"visit")?"productUpdate":"product","visit"===o||"update"===o)if(s.id)if(s.name=taggstar._sanitizeName(s.name),(r=taggstar._sanitizePrice(s.price)).error)a(new x({message:r.error,code:"CORE06",severity:49}));else{s.price=r.price,s.category=taggstar._sanitizeCategory(s.category);var n=taggstar._buildRequest({product:s});taggstar.submitData(e,n).then(function(e){taggstar._addResponseToCookie(e.responseData,e.jqXHR),t(e.responseData)}).catch(function(e){a(e)})}else a(new x({message:"no product id",code:"CORE10",severity:51}));else a(new x({message:"invalid action type: "+o,code:"CORE05",severity:99}))})},taggstar.categoryRequest=function(r){return new Promise(function(t,a){var e;!Array.isArray(r.products)||Array.isArray(r.products)&&0===r.products.length?a(new x({message:"product ids for category cannot be empty",code:"CORE26",severity:51})):(r.category=taggstar._sanitizeCategory(r.category),r.products.some(function(e){return!e})?a(new x({message:"no product id for category: "+r.category,code:"CORE14",severity:51})):(e=taggstar._buildRequest(r),taggstar.submitData("category",e).then(function(e){taggstar._addResponseToCookie(e.responseData,e.jqXHR),t(e.responseData)}).catch(function(e){a(e)})))})},taggstar.basketRequest=function(r){return new Promise(function(t,a){var e;r.lineItems=k.cleanDuplicateProducts(r.lineItems),e=taggstar._buildRequest({basket:r}),taggstar.submitData("basket",e).then(function(e){taggstar._addResponseToCookie(e.responseData,e.jqXHR),t(e.responseData)}).catch(function(e){a(e)})})},taggstar.conversionRequest=function(n,s){return new Promise(function(t,a){var e,r;n.id?(r=taggstar._sanitizePrice(n.totalPrice)).error?a(new x({message:r.error,code:"CORE16",severity:49})):(n.orderItems=k.cleanDuplicateProducts(n.orderItems),n.currency=n.currency?n.currency:taggstar.config.currencyCode,e=taggstar._buildRequest({order:n},s),taggstar.submitData("conversion",e).then(function(e){k.debugDialog("Conversion successful!",e.responseData,"green"),t(e.responseData)}).catch(function(e){k.debugDialog("Conversion server error!",e,"red"),a(e)})):a(new x({message:"no order id",code:"CORE15",severity:51}))})},taggstar.eventRequest=function(s,o){return new Promise(function(t,a){var e,r,n;e=o?(n=k.getPageData("responseData",o)&&k.getPageData("responseData",o).eventGroupId,s.eventGroupId||(s.eventGroupId=n),taggstar._buildRequestV2({event:s},o,!0)):(n=k.getPageData("responseData")&&k.getPageData("responseData").eventGroupId,s.eventGroupId||(s.eventGroupId=n),taggstar._buildRequest({event:s})),r="{ "+s.category+" : "+s.name+" }",taggstar.submitData("event",e).then(function(e){taggstar.log("Event "+r+" successfully recorded"),t(e.responseData)}).catch(function(e){a(e)})})},taggstar.eventQueryRequest=function(r){return new Promise(function(t,a){var e=taggstar._buildRequest({query:r});taggstar.submitData("eventQuery",e).then(function(e){taggstar.log("Success"),taggstar.log(e.responseData),t(e.responseData)}).catch(function(e){a(e)})})},taggstar.productQueryRequest=function(g){return new Promise(function(t,a){var e,r,n,s,o,i=taggstar.util.createTaggstarQueryString();i?i+="&":i="?",!Array.isArray(g)||Array.isArray(g)&&0===g.length?a(new x({message:"product ids for getProducts cannot be empty",code:"CORE26",severity:51})):g.some(function(e){return!e})?a(new x({message:"missing product id",code:"CORE14",severity:51})):((e=taggstar._getClientObj())&&(e.locale&&(i+="locale="+e.locale+"&"),e.deviceType&&(i+="deviceType="+e.deviceType+"&")),(r=taggstar._getExpObj("socialproof"))&&0<Object.keys(r).length&&("experience"===Object.keys(r)[0]?i+="experienceId="+r.experience.id+"&":i+="experimentId="+r.experiment.id+"&experimentGroup="+r.experiment.group+"&"),i+="ids="+g.join(","),taggstar.config?(n=taggstar.config.api.products)?(o=n.verb,s=taggstar.config.urls.apiRoot+n.endpoint,s+=i,taggstar.log("getting data","info"),taggstar.util.jsonCall(o,s).then(function(e){taggstar._addResponseToCookie(e,null,"productQuery"),t(e)}).catch(function(e){a(e)})):a(new x({message:"unknown API method: products",code:"CORE07",severity:99})):a(new x({message:"config not found",code:"CORE13",severity:99})))})},taggstar.getVisitor=function(e){var t=taggstar._updateVisitorSession();return{sessionId:t,id:taggstar._updateVisitorId(e||t)}},taggstar.getExperimentGroup=function(){var e=taggstar._getExperimentData(!0);return e&&e.experimentGroup},taggstar.getExperimentGroupV2=function(e){var t=taggstar._getExperimentDataV2();return t&&t[e]&&t[e].group},taggstar.getDetail=function(e){return taggstar.pageData&&taggstar.pageData[e]&&taggstar.pageData[e].responseData&&taggstar.pageData[e].responseData.detail},taggstar.deleteVisitor=function(){k.deleteCookie(n),k.deleteCookie(r),k.deleteCookie(s),taggstar.log("Visitor info deleted")},taggstar.handleProductResponse=function(s){return new Promise(function(e,t){taggstar.log("response received","info"),taggstar.log(s,"info");var a,r=s.socialProof,n=r&&Array.isArray(r)&&r.length?r[0].messages:[];for(a=n.length-1;0<=a;a--)n[a].message||(n.splice(a,1),taggstar.exception.handle(new x({message:"missing message body",code:"CORE19",severity:81})));e(n)})},taggstar.handleAssistantResponse=function(r){return new Promise(function(e,t){taggstar.log("response received","info"),taggstar.log(r,"info");var a=r.assistant;a&&Array.isArray(a)?e(a.reduce(function(e,t){return Object.assign(e,_defineProperty({},t.algorithm,{products:t.products,templates:t.templates.reduce(function(e,t){return Object.assign(e,_defineProperty({},t.id,t.template))},{})}))},{})):t(new x({message:"invalid query result",code:"ASST13",severity:99,module:"assistant:"+(taggstar.config.assistant&&taggstar.config.assistant.pageType)}))})},taggstar.handleRequest=taggstar.handleProductResponse,taggstar.handleResponseMulti=function(g){return new Promise(function(e,t){taggstar.log("response received","info"),taggstar.log(g,"info");var a,r,n,s,o=g.socialProof,i={};if(o&&Array.isArray(o)&&0<o.length)for(a=0;a<o.length;a++)n=(r=o[a]).product&&r.product.id,s=r.product&&r.product.variant&&JSON.stringify(r.product.variant),n?r.messages&&(i[s?n+y+s:n]=r.messages):taggstar.exception.handle(new x({message:"missing product id",code:"CORE20",severity:81}));e(i)})},taggstar._defaultMessageParams={firstDelay:500,delayBetween:2500,fade:750,hold:3500,isMobile:!1,tries:50,testInterval:500,insertFunction:"append",wrapperClass:"tagg-balloons-wrapper",extraClass:"",extraBalloonClass:"",closeButton:!1,decor:!1,balloonDisplayCount:0,animatePre:{opacity:0},animateIn:{opacity:1},animateOut:{opacity:0},customAnimation:!1,iconCss:null,txtCss:null,closeCss:null,wrapperStyle:null,experienceWrapperClass:""},taggstar.displayMessageBalloons=function(p,f,e,m,t){return new Promise(function(n,s){if(Array.isArray(p)&&p.length){var o,i,g=[],c=k.getBalloonParams(e,t),l=0;taggstar.searchingDom=!0,i=setInterval(function(){if(taggstar.searchingDom){var e,t,a=taggstar.$(f);try{t="function"!=typeof m||m()}catch(e){return++l>c.tries?(clearInterval(i),taggstar.searchingDom=!1,void s(e instanceof x?e:new x({stack:e.stack,name:e.name,message:e.message,code:"CORE04",severity:99}))):void 0}if(!t||0===a.length)return++l>c.tries?(clearInterval(i),taggstar.searchingDom=!1,void s(new x({message:"balloon anchor not present in DOM: "+f+"/condition does not met",code:"CORE11",severity:99}))):void taggstar.log("looking for balloon anchor DOM element/running condition","warn");clearInterval(i),delete taggstar.searchingDom,taggstar.log("adding balloons to DOM"),e=k.getBalloonContainer(c);try{a[c.insertFunction](e)}catch(e){return void s(new x({message:"problem applying jQuery method: "+c.insertFunction,code:"CORE12",severity:99}))}o=taggstar.$("."+c.wrapperClass.replace(" ","."));for(var r=0;r<p.length;r++)!function(e){var t=k.getBalloon(p[e],"balloon",c,e);g[e]=setTimeout(function(){c.balloonDisplayCount++,c.customAnimation?c.customAnimation(o,t,c,e,function(e){u(c,t,e)},function(){d(t)}):(t.css(c.animatePre),o.append(t),t.animate(c.animateIn,c.fade,function(){u(c,t)}))},c.firstDelay+e*c.delayBetween)}(r);n(!0)}},c.testInterval)}else n(!1);function u(e,t,a){if(a=a||r,e.closeButton&&t.find(".tagg-x").click(function(){taggstar.log("balloon close button clicked");var e=t.data("tagg-index");clearTimeout(g[e]),a(t)}),0===t.data("tagg-index")&&"function"==typeof e.callback)try{e.callback()}catch(e){taggstar.exception.handle(new x({message:"reporting callback failed with error "+e,code:"CORE22",severity:81}))}taggstar.keepUI||setTimeout(function(){a(t)},e.hold)}function r(e){e.animate(c.animateOut,c.fade,function(){d(e)})}function d(e){e.css({zIndex:"-1",opacity:0,display:"block"}),c.balloonDisplayCount--,0===c.balloonDisplayCount&&(taggstar.log("removing balloon container"),o.remove())}})},taggstar.displayMessageBalloonsMulti=function(p,f,m,e,v){return new Promise(function(e,t){var a,r,n,s,o,i,g,c,l,u,d=k.getBalloonParams(m,v);if("function"==typeof f){for(a in p)for(r=p[a],n=0;n<r.length;n++)if(s=r[n],o=k.getBalloonContainer(d),i=k.getBalloon(s),o.append(i),-1<a.indexOf(y)&&(l=(c=a.split(y))[0],u=c[1]),(g=l?f(l,JSON.parse(u)):f(a))&&g.length){taggstar.log("adding balloons to DOM");try{g[d.insertFunction](o)}catch(e){return void t(new x({message:"problem applying jQuery method: "+d.insertFunction,code:"CORE23",severity:99}))}}else taggstar.log("no anchor returned for product "+(l?l+" and for variant ["+u+"]":a),"warn");e(!0)}else t(new x({message:"findAnchor parameter not a function",code:"CORE24",severity:99}))})},taggstar._defaultParams={assistant:{wrapperClass:"tagg-asst-wrapper",extraClass:"",algoClass:"tagg-asst-algo",extraAlgoClass:"",experienceWrapperClass:"",isMobile:!1,tries:50,testInterval:500,insertFunction:"append",balloonAnchor:"",balloonAnchorInsertFunction:"append",balloonWrapperClass:"tagg-asst-balloons-wrapper",balloonExtraClass:"",balloonExtraBalloonClass:"",balloonCloseButton:!1,balloonDecor:!1,headerTemplate:"<h1>{templates.header}</h1>",subheaderTemplate:"",additionalTemplate:"",footerTemplate:"",utils:{},cardImageTemplate:'<div class="tagg-asst-image-container"><a class="tagg-asst-card-link" data-product="{id}" data-category="{algorithm}" href="{url}"><img class="tagg-reset tagg-asst-card-image" alt="{title}" title="{title}" src="{image}" /></a></div>',cardInfoTemplate:'<div class="tagg-asst-info-container"><div class="tagg-asst-info-title"><a class="tagg-asst-card-link" data-product="{id}" data-category="{algorithm}" href="{url}">{title}</a></div><div class="tagg-asst-info-price">{price}</div></div>',cardAdditionalTemplate:"",onCardClick:function(e){var t,a=taggstar.$(this).attr("href"),r=taggstar.$(this).data("product"),n=taggstar.$(this).data("category"),s=taggstar.$(this).data("event-value")||1,o=k.getPageData("responseData","assistant")&&k.getPageData("responseData","assistant").eventGroupId;t="assistant"+y+n+y+r+y+s,o&&(t+=y+o),r&&n?(k.setCookie(c,t,.5),setTimeout(function(){self.location=a},100),e.preventDefault()):self.location=a}}},taggstar.displayAssistant=function(l,u,t,d){return new Promise(function(a,r){if(Object.values(l).some(function(e){return e.products&&0<e.products.length})){var n,e,s=k.getParams("assistant",t,d),o=0,i=[],g=taggstar.config,c=function(e){var t=k.assistant.getAssistantContainer(s);try{e[s.insertFunction](t)}catch(e){return void r(new x({message:"problem applying jQuery method: "+s.insertFunction,code:"ASST12",severity:99,module:"assistant:"+(taggstar.config.assistant&&taggstar.config.assistant.pageType)}))}try{for(var a in l)n=l[a],t.append(k.assistant.getAssistant(a,n))}catch(e){return void r(new x({message:"problem during card creation: "+e.message,code:"ASST12",severity:99,module:"assistant:"+(taggstar.config.assistant&&taggstar.config.assistant.pageType)}))}};k.setPageData("searchingDom",!0,"assistant"),e=setInterval(function(){if(k.getPageData("searchingDom","assistant")){var t=taggstar.$(u);if(0===t.length)return++o>s.tries?(clearInterval(e),k.setPageData("searchingDom",!1,"assistant"),void r(new x({message:"assistant anchor not present in DOM: "+u,code:"CORE11",severity:99,module:"assistant:"+(taggstar.config.assistant&&taggstar.config.assistant.pageType)}))):void taggstar.log("looking for assistant anchor DOM element","warn");clearInterval(e),k.deletePageData("searchingDom","assistant"),taggstar.log("adding assistants to DOM"),g.carouselCSS&&i.push(k.loadTag(g.carouselCSS,"link","head",f)),g.carouselJS&&i.push(k.loadTag(g.carouselJS,"script","head",p)),i.length?Promise.all(i).then(function(e){e.forEach(function(e){taggstar.log(e.url+" "+e.tag+" tag loaded","info")}),c(t),a(!0)}).catch(r):(c(t),a(!0))}},s.testInterval)}else a(!1)})},taggstar._saveExperimentData=function(e){var t=k.encodeCookieString(e);k.setCookie(n,t,129600)},taggstar._saveExperimentDataV2=function(e){var t=JSON.stringify(e);k.setCookie(a,t,129600)},taggstar._updateVisitorSession=function(e){var t,a=k.getCookie(r)||e;return a?(k.setCookie(r,a,30),a):(t=taggstar.config.idGenerator(),taggstar.log("created new session cookie "+t),k.setCookie(r,t,30),t)},taggstar._updateVisitorId=function(e){var t,a=k.getCookie(s)||e;return a?(k.setCookie(s,a,129600),a):(t=taggstar.config.idGenerator(),taggstar.log("created new visitor cookie "+t),k.setCookie(s,t,129600),t)},taggstar._getExperimentData=function(e){var t=k.getCookie(n);return t?k.decodeCookieString(t,e):null},taggstar._getExperimentDataV2=function(){var e=k.getCookie(a);return e?k.decodeCookieStringV2(e):null},taggstar._buildRequest=function(e,t){var a,r,n,s,o,i=taggstar._getExperimentData(!0);for(var g in a={visitor:taggstar.getVisitor(i&&i.id)},e)e.hasOwnProperty(g)&&(a[g]=e[g]);return(s=taggstar._getClientObj())&&(a.client=s),(o=taggstar._getExpObj("socialproof"))&&0<Object.keys(o).length&&(a[Object.keys(o)[0]]=o[Object.keys(o)[0]]),t&&(a.dimensions=k.validateDimensions(t)),a.product&&(r=k.getCookie(c))&&(3<(n=r.split(y)).length&&(a.event={category:n[0],name:(n[1]?n[1]+"-":"")+"product-click",data:{label:n[2],value:n[3]}},n[4]&&(a.event.eventGroupId=n[4])),k.setPageData("embeddedEvent",a.event,"product"),k.deleteCookie(c)),a},taggstar._buildRequestV2=function(e,t,a){var r,n,s,o=taggstar.config;for(var i in r={visitor:taggstar.getVisitor()},e)e.hasOwnProperty(i)&&(r[i]=e[i]);return(n=taggstar._getClientObj())&&(r.client=n),(s=taggstar._getExpObj(t))&&0<Object.keys(s).length&&(r[Object.keys(s)[0]]=s[Object.keys(s)[0]]),"assistant"!==t||a||(r.page={type:o.assistant.pageType},o.assistant.pageId&&(r.page.id=o.assistant.pageId)),r},taggstar._getExpObj=function(e){var t,a,r=taggstar.config;return"socialproof"===e?(t=taggstar._getExperimentData(!0),r.experienceRequired?a={experience:{id:r.experienceId}}:(t?t.id&&(t.cookieVersion=r.cookieVersion,taggstar._saveExperimentData(t)):(t={cookieVersion:r.cookieVersion},taggstar._saveExperimentData(t)),t.experimentId&&((a={experiment:{id:t.experimentId,group:t.experimentGroup}}).experiment.group||delete a.experiment))):(t=taggstar._getExperimentDataV2(),r[e].experienceRequired?a={experience:{id:r[e].experienceId}}:(t?t&&!t[e]&&(t[e]={}):((t={})[e]={},taggstar._saveExperimentDataV2(t)),t[e]&&t[e].id&&((a={experiment:{id:t[e].id,group:t[e].group}}).experiment.group||delete a.experiment))),a},taggstar._getClientObj=function(){var e,t=taggstar.config;return(!taggstar.debug&&t.version||t.deviceType||t.locale)&&(e={},!taggstar.debug&&t.version&&(e.expectedSiteConfigVersion=t.version),t.deviceType&&(e.deviceType=t.deviceType),t.locale&&(e.locale=t.locale)),e},taggstar._addResponseToCookie=function(e,t,a){var r;taggstar.config.experienceRequired||taggstar._debugParamUsed()?taggstar.config.experienceRequired&&k.deleteCookie(n):t&&"delete"===t.getResponseHeader("X-Taggstar-Experiment")?taggstar.deleteVisitor():(r=taggstar._getExperimentData(!0),e.experiment&&(e.experiment.id!==r.experimentId&&delete r.modules,r.experimentGroup=e.experiment.group,r.experimentId=e.experiment.id),taggstar._saveExperimentData(r)),e.result&&k.setPageData("responseData",{eventGroupId:e.result.eventGroupId,moduleRunId:e.result.moduleRunId,detail:e.detail},a)},taggstar._addResponseToCookieV2=function(e,t,a){var r;taggstar.config[a].experienceRequired||taggstar._debugParamUsed()?taggstar.config[a].experienceRequired&&taggstar._deleteExperimentCookie(a):(r=taggstar._getExperimentDataV2(),e.experiment&&(r[a].group=e.experiment.group,r[a].id=e.experiment.id),taggstar._saveExperimentDataV2(r)),e.result&&k.setPageData("responseData",{eventGroupId:e.result.eventGroupId,moduleRunId:e.result.moduleRunId,detail:e.detail},a)},taggstar._deleteExperimentCookie=function(e){var t=taggstar._getExperimentDataV2();t?1===Object.keys(t).length&&t[e]?k.deleteCookie(a):(delete t[e],taggstar._saveExperimentDataV2(t)):k.deleteCookie(a)},taggstar._sanitizeName=function(e){return e&&"string"==typeof e?e=(e=(e=(e=e.trim()).replace(/\s+/g," ")).substring(0,64))||"-":"-"},taggstar._sanitizeCategory=function(e){return e=e&&"string"==typeof e?((e=(e=(e=(e=(e=e.replace(/^\s*/g,"").replace(/\s*$/g,"")).replace(/\s*\/\s*/g,"/")).replace(/\s+/g," ")).replace(/\/$/,"")).substring(0,256))&&"/"!=e[0]&&"-"!==e&&(e="/"+e),e||"-"):"-"},taggstar._sanitizePrice=function(e){var t,a={error:"",price:0},r=0;if("number"==typeof e)return a.price=e,a;if(e)try{if(!(0<=(t=e.search(/\d+/))))return a.error="price field contains no digits",a;if(e=e.substring(t),r=parseFloat(e),!isNaN(r))return a.price=r,a;a.error="price field can't be parsed"}catch(e){a.error=e.message}return a},taggstar._debugParamUsed=function(){return taggstar.params.taggExperimentId||taggstar.params.taggExperimentGroup||taggstar.params.taggExperienceId||taggstar.params.taggFakeData||taggstar.params.taggDeviceType||taggstar.params.taggEnv},taggstar.log("methods loaded","info"),taggstar.loaded=!0,taggstar.setup().catch(taggstar.exception.handle)}();